<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAABE0AA8AAAAAHWwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY3d1HZY21hcAAAAdgAAACqAAACOvWLi0FjdnQgAAAChAAAABMAAAAgBtX/BGZwZ20AAAKYAAAFkAAAC3CKkZBZZ2FzcAAACCgAAAAIAAAACAAAABBnbHlmAAAIMAAABdQAAAjkYT9TNWhlYWQAAA4EAAAAMwAAADYQ6WvNaGhlYQAADjgAAAAfAAAAJAc6A1pobXR4AAAOWAAAACAAAAA0Kmz/7mxvY2EAAA54AAAAHAAAABwQPBJubWF4cAAADpQAAAAgAAAAIAEHC/NuYW1lAAAOtAAAAYQAAALxhQT4h3Bvc3QAABA4AAAAfgAAAMS3SYh9cHJlcAAAELgAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZHZmnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4Pwz+yMwf9z2KIYg5imAYUZgTJAQDcoQvQAHic7ZHNDYJAFIRnBXf94cDRIiyCKkCpwFCPJ092RcKNDoYKcN4+EmMPvpdvk539zQyAPYBCXEUJhBcCrJ5SQ9YLnLJe4qF5rdb+uWPDngNHTkta101pNyWa8lMhn6xx2dqUnW4q9YOIhAOOeueMSgsR/6ry+P7O5s6xVNg4chBsHUuFnWNJ8uZYwrw7chrsHXkODo7cB0dHOYCTY8kv0VE2WJKD6gOlWjsxAAB4nGNgQAMSEMgc9D8LhAESbAPdAHicrVZpd9NGFB15SZyELCULLWphxMRpsEYmbMGACUGyYyBdnK2VoIsUO+m+8Ynf4F/zZNpz6Dd+Wu8bLySQtOdwmpOjd+fN1czbZRJaktgL65GUmy/F1NYmjew8CemGTctRfCg7eyFlisnfBVEQrZbatx2HREQiULWusEQQ+x5ZmmR86FFGy7akV03KLT3pLlvjQb1V334aOsqxO6GkZjN0aD2yJVUYVaJIpj1S0qZlqPorSSu8v8LMV81QwohOImm8GcbQSN4bZ7TKaDW24yiKbLLcKFIkmuFBFHmU1RLn5IoJDMoHzZDyyqcR5cP8iKzYo5xWsEu20/y+L3mndzk/sV9vUbbkQB/Ijuzg7HQlX4RbW2HctJPtKFQRdtd3QmzZ7FT/Zo/ymkYDtysyvdCMYKl8hRArP6HM/iFZLZxP+ZJHo1qykRNB62VO7Es+gdbjiClxzRhZ0N3RCRHU/ZIzDPaYPh788d4plgsTAngcy3pHJZwIEylhczRJ2jByYCVliyqp9a6YOOV1WsRbwn7t2tGXzmjjUHdiPFsPHVs5UcnxaFKnmUyd2knNoykNopR0JnjMrwMoP6JJXm1jNYmVR9M4ZsaERCICLdxLU0EsO7GkKQTNoxm9uRumuXYtWqTJA/Xco/f05la4udNT2g70s0Z/VqdiOtgL0+lp5C/xadrlIkXp+ukZfkziQdYCMpEtNsOUgwdv/Q7Sy9eWHIXXBtju7fMrqH3WRPCkAfsb0B5P1SkJTIWYVYhWQGKta1mWydWsFqnI1HdDmla+rNMEinIcF8e+jHH9XzMzlpgSvt+J07MjLj1z7UsI0xx8m3U9mtepxXIBcWZ5TqdZlu/rNMfyA53mWZ7X6QhLW6ejLD/UaYHlRzodY3lBC5p038GQizDkAg6QMISlA0NYXoIhLBUMYbkIQ1gWYQjLJRjC8mMYwnIZhrC8rGXV1FNJ49qZWAZsQmBijh65zEXlaiq5VEK7aFRqQ54SbpVUFM+qf2WgXjzyhjmwFkiXyJpfMc6Vj0bl+NYVLW8aO1fAsepvH472OfFS1ouFPwX/1dZUJb1izcOTq/Abhp5sJ6o2qXh0TZfPVT26/l9UVFgL9BtIhVgoyrJscGcihI86nYZqoJVDzGzMPLTrdcuan8P9NzFCFlD9+DcUGgvcg05ZSVnt4KzV19uy3DuDcjgTLEkxN/P6VvgiI7PSfpFZyp6PfB5wBYxKZdhqA60VvNknMQ+Z3iTPBHFbUTZI2tjOBIkNHPOAefOdBCZh6qoN5E7hhg34BWFuwXknXKJ6oyyH7kXs8yik/Fun4kT2qGiMwLPZG2Gv70LKb3EMJDT5pX4MVBWhqRg1FdA0Um6oBl/G2bptQsYO9CMqdsOyrOLDxxb3lZJtGYR8pIjVo6Of1l6iTqrcfmYUl++dvgXBIDUxf3vfdHGQyrtayTJHbQNTtxqVU9eaQ+NVh+rmUfW94+wTOWuabronHnpf06rbwcVcLLD2bQ7SUiYX1PVhhQ2iy8WlUOplNEnvuAcYFhjQ71CKjf+r+th8nitVhdFxJN9O1LfR52AM/A/Yf0f1A9D3Y+hyDS7P95oTn2704WyZrqIX66foNzBrrblZugbc0HQD4iFHrY64yg18pwZxeqS5HOkh4GPdFeIBwCaAxeAT3bWM5lMAo/mMOT7A58xh0GQOgy3mMNhmzhrADnMY7DKHwR5zGHzBnHWAL5nDIGQOg4g5DJ4wJwB4yhwGXzGHwdfMYfANc+4DfMscBjFzGCTMYbCv6dYwzC1e0F2gtkFVoANTT1jcw+JQU2XI/o4Xhv29Qcz+wSCm/qjp9pD6Ey8M9WeDmPqLQUz9VdOdIfU3Xhjq7wYx9Q+DmPpMvxjLZQa/jHyXCgeUXWw+5++J9w/bxUC5AAEAAf//AA94nIVVX2hbZRQ/5/t7893s5ja9f7ouzdZ0TTqz3bRJmogbWya6bG6Cq0VbSV2ddIJjFtfIQHEig80Hda8yUN/0YQz8AyriiyD+xQd92R4HCnaCb3samnpumrpsCsLlfPf7zvedc37nL3CAtc/5W/wQZGA3tOBSY/g+TMjHmwzEoM1Q8+ZjRZY4oJhmBw5/YB6Za0yC5AkhlwA1A1yCBIBOwCII0Cj0U8BAMdUCzq05sKwkP7SlUY6fcJk4Fb/RyE79/6P5hjM/F4aZiXBoeMgzcqQ4Xi1hPqfDLG5FT+lchCVU3lYMyvuwhl1mqndQL0RsuloLywHtthLXI06OblTrhfWVnpSJ5+mwu/JdbtuN3IAnkW0LLMcRwaC7ktrlzridM6kVdyf9uO1UNBByI7JhwtG2sEwab07ORBeilWhqavJCqV0qzZTOl/7ZXQ5TbTcdcFelyGhhRDAQpdqp1FEX3w3cFTc1k9pJQkmm4ySCbSikxRP2QOfN+0tHS5MrpQuTU1Mk5nw0E5Xa0WvrOwDyGax9yB9ma6DAg82wHc43SAGTI4GjBWebOePAERFE8/AHaQpZASSTy8A4WwZiLQMQ82mFKATO0ILicRAoDm9p5P99E5b/fXG+kQYY3TYUuqmERWYoT0u/GNYL2q/4WB3LaVS+VynXsVYIcWw6DkCh3nX1D+VzlYN4LClF5yexSQos8exqZ3KVP+wtrC54u4Nznq6cq+xpMpUUnZ8FUYzE86ud0g28NOIv3Gj5/rmA3ABs7S/ywzFuQ4qyd6QxfNtiQIaEgp3w/entQg4Vcbqa16M5FfpeUB8t1+qeg7mI7cUyOe79wOk86gSxkVec4KPTX69++5x68Yubn5/F+w52z7u08sJX7fZXv8ekT/d2mILJxq6sn+SC6qEJknzLJCxyZEKwWVqYmAPBxBE/9DLeZiWHu7lcr/VytrCRuHojncNuTt9h46tmacmYisnSamdN2bZptcsmSysdVsy1PrOvOzF3xN64Rb937t/og9KHxYdcjIUqFAmIAHGHNzlns+RTPgeUYAQm9DwpNxfxbhhBHPaw3/gfTcXO2L+eJVIx5nsyGkvm9X4/f+bGkH45G0PaSjcMXTjcZyTvi3UdHoCDjQd3IDUVsgwYmUoJK/gp4JJxeRI0MKHZIkgynyIBqBTOUs6rOVCojvjZ4mCQz49ZMlMcp8QoYk6NoBfsxnJtsBohpa8iGJS+ZH7gU7NxME6cmF+t7cO9vB8d3jTWSct0ycW9ranXmolNDwmVkNnxe+8JtoztwS5rKJ0xWS95tQ/1zMYzg69MzUZnNtl1ofNbsml/OJm6f9wjRjpnu2o4MzHzn77IQkRd+1DjwMQ2pqSjGMMhyjrgTbBAKksuUm0iU7hI0aN2wOKOq7WYBSH0HGihj/jkiPxAfmwsEbfYrjMG+j3ij932Db/LV7I/xruNrhnroxjR9HRMb2nTvO0ZXOoHPk8H2ZhDPx93qcE/53sH5np/dkIP7zzhTVKdR/BAY/9ElkkR+A6lJGsqpJ4oQcTxpvBT3Kn58VkaJjgHyPEIws57xkaHh9KuVpDEpJZeMbZ5w/zBHi5NMQ4r5VphsFqID7TyB9eR4pX216c3AHxpdAwoqU9qg0ZJ6yVLKmMSz1iG2z27ifx18NkY0LPx1W/wCc2l5LrznrIsiKsqbmB78A9wIGx4tI8rjihVHJyY9pgMirenVq0yWg7Iw7eogG7ZgYM3qR9959A/fZkg6MnD/exlkmc+jWV4SB15XUR+eqC6l6ZmgPtN9z5JMfik05OV8ljylunJ4J+wA/FUaQSSKotsYsCWqaPBidBLcxkWx7XKFRIb45TGaEhjlF9uUVPqXOtcIwsXbBvfoZXIyRYFdkfnqjExH98xpnPczqzjX/uNdO1Y17Wpi5+6Ts8BXtjVFasp9KZ1mOiNbH65c5w6HgmyF2jFCZywM8mWjRc7T5Pmt0lRy7Y71+jYbpGyvwG4sH0XeJxjYGRgYADiwBB/53h+m68M3MwvgCIM1z5N/g6j///9v5H5BbMnkMvBwAQSBQCIcA9gAHicY2BkYGAO+p8FJF/8//v/F/MLBqAICuAFALYQB5kAeJxjfsHAwLwAiCNB+P9fbJjJmoGBMRUo/wKCAfO2EnQAAAAAANoBXgGcAgICVALaA1IDvAPkBAYEPARyAAEAAAANAF0ABAAAAAAAAgAUACQAcwAAAG4LcAAAAAB4nHWRzWrCQBSFT+pPqUIXLXTTzayKUohGKIibCoLuhbrrYtTRxCYZmYyKyz5Fd32HvlDfoO/QkziIFJtw9bvnnpl7ZwLgBt/wcHieGAf2UGd24Atcou+4RH3kuEweO66QXx1XyaHjGh6ROa7jFp/cwStfMVvhy7GHO+/e8QWuvcBxifqz4zL5xXGF/Oa4Sn53XMPE+3Bcx4P3M9DrvYmWoRWNQVN02kFXTPdCU4pSGQu5saE2meiLhU6timPtz3SSs9ypTCdqrJabWJoT5QQnymSRTkXgt0/UkUqVkVbN807ZdtmxdiEWRidi6HqItdErNbN+aO2612qd9sYAGmvsYRBhyUu0EGhQbfK/gzYCdElTOgSdB1eEFBIxFYkNV4RFJWPeZyyYpVQVHTHZx4y/yVGX2LGWFZri51TccUOn5B7nPefVCSPvGhVVwUl9znveO2KkhV8Wk82PZ8qwZf8OVcu1+fSmWCMw/HMOwXvKaysqM+p+cVuWag8tvv+c+xdd+4+teJxtjUEOwiAURJla24KliQfhUA2g/Sl+CKXx+loNrpzVezOLEY34Ron/0WhwQoszOvQYIKFwwQiNSbSBeO2SZ0tBP4j3zVjKNng32ZmtD1VVXCuOiw/pJ8S3WOU6l+K5UOTaDC4+2TjKMtN9KQf1ezLx/Sg/00FCvABHhjDjAAB4nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjEwMmiBGJu5mBg5ICw+BjCLzWkX0wGgNCeQze60i8EBwmZmcNmowtgRGLHBoSNiI3OKy0Y1EG8XRwMDI4tDR3JIBEhJJBBs5mFi5NHawfi/dQNL70YmBhcADHYj9AAA) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>Final_Project</title></head><body><article class="markdown-body"><h1 id="final-project">Final Project<a class="headerlink" href="#final-project" title="Permanent link"></a></h1>
<p>Hive, Scala on Spark, and Java</p>
<h3 id="problem-1">Problem 1<a class="headerlink" href="#problem-1" title="Permanent link"></a></h3>
<ol>
<li>In Oshkosh, which is more common: days where the temperature was really cold (-10 or lower) at any point during the day or days where the temperature was hot (95 or higher) at any point during the day?</li>
</ol>
<div class="codehilite"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">(</span><span class="k">year</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">month</span> <span class="nb">INT</span><span class="p">,</span>
<span class="k">day</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">time</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">temperature</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">dewpoint</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">humidity</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">sea_level_pressure</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">visibility</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">wind_direction</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">gust_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">precip</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">events</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">conditions</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_degrees</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;,&#39;</span>
<span class="k">LOCATION</span> <span class="s1">&#39;/user/maria_dev/final/Oshkosh/&#39;</span><span class="p">;</span>


<span class="k">SELECT</span>
    <span class="s1">&#39;cold&#39;</span> <span class="k">as</span> <span class="n">temp</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">concat_ws</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">month</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">),</span> <span class="k">CAST</span><span class="p">(</span><span class="k">day</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">),</span> <span class="k">CAST</span><span class="p">(</span><span class="k">year</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">)))</span> <span class="k">as</span> <span class="n">num_days</span>
<span class="k">FROM</span> 
    <span class="n">oshkosh_tbl</span> <span class="n">o</span>
<span class="k">WHERE</span>
    <span class="n">temperature</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">10</span> <span class="k">AND</span>
    <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>

<span class="k">UNION</span>

<span class="k">SELECT</span>
    <span class="s1">&#39;hot&#39;</span> <span class="k">as</span> <span class="n">temp</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">concat_ws</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="k">month</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">),</span> <span class="k">CAST</span><span class="p">(</span><span class="k">day</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">),</span> <span class="k">CAST</span><span class="p">(</span><span class="k">year</span> <span class="k">AS</span> <span class="n">STRING</span><span class="p">)))</span> <span class="k">as</span> <span class="n">num_days</span>
<span class="k">FROM</span> 
    <span class="n">oshkosh_tbl</span> <span class="n">o</span>
<span class="k">WHERE</span>
    <span class="n">temperature</span> <span class="o">&gt;=</span> <span class="mi">95</span> <span class="k">AND</span>
    <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>
</pre></div>

<ol>
<li>When I moved from Wisconsin to Iowa for school, the summers and winters seemed similar but the spring and autumn seemed much more tolerable. For this problem, we will be using meteorological seasons:</li>
</ol>
<p><div class="codehilite"><pre>Winter - Dec, Jan, Feb
Spring - Mar, Apr, May
Summer - Jun, Jul, Aug
Fall - Sep, Oct, Nov
</pre></div>
Compute the average temperature (sum all temperatures in the time period and divide by the number of readings) for each season for Oshkosh and Iowa City. What is the difference in average temperatures for each season for Oshkosh vs Iowa City?</p>
<div class="codehilite"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">(</span><span class="k">year</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">month</span> <span class="nb">INT</span><span class="p">,</span>
<span class="k">day</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">time</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">temperature</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">dewpoint</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">humidity</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">sea_level_pressure</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">visibility</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">wind_direction</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">gust_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">precip</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">events</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">conditions</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_degrees</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;,&#39;</span>
<span class="k">LOCATION</span> <span class="s1">&#39;/user/maria_dev/final/Oshkosh/&#39;</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">iowacity_tbl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">iowacity_tbl</span><span class="p">(</span><span class="k">year</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">month</span> <span class="nb">INT</span><span class="p">,</span>
<span class="k">day</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">time</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">temperature</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">dewpoint</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">humidity</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">sea_level_pressure</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">visibility</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">wind_direction</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">gust_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">precip</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">events</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">conditions</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_degrees</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;,&#39;</span>
<span class="k">LOCATION</span> <span class="s1">&#39;/user/maria_dev/final/IowaCity/&#39;</span><span class="p">;</span>


<span class="k">SELECT</span>
    <span class="n">oshkosh</span><span class="p">.</span><span class="n">season</span> <span class="k">as</span> <span class="n">season</span><span class="p">,</span>
    <span class="n">round</span><span class="p">(</span><span class="n">oshkosh</span><span class="p">.</span><span class="n">avg_temp</span> <span class="o">-</span> <span class="n">iowacity</span><span class="p">.</span><span class="n">avg_temp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_temp_diff</span>
<span class="k">FROM</span>
    <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Winter&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Spring&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Summer&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Fall&#39;</span>
            <span class="k">else</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="n">season</span><span class="p">,</span>
        <span class="k">sum</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="k">count</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_temp</span>
    <span class="k">FROM</span> 
        <span class="n">oshkosh_tbl</span> <span class="n">o</span>
    <span class="k">WHERE</span>
        <span class="n">temperature</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span>
        <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>
    <span class="k">GROUP</span> <span class="k">BY</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Winter&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Spring&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Summer&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Fall&#39;</span>
            <span class="k">else</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">END</span>
    <span class="p">)</span> <span class="n">oshkosh</span>
<span class="k">JOIN</span>
    <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Winter&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Spring&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Summer&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Fall&#39;</span>
            <span class="k">else</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="n">season</span><span class="p">,</span>
        <span class="k">sum</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="k">count</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_temp</span>
    <span class="k">FROM</span> 
        <span class="n">iowacity_tbl</span> <span class="n">i</span>
    <span class="k">WHERE</span>
        <span class="n">temperature</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span>
        <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>
    <span class="k">GROUP</span> <span class="k">BY</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Winter&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Spring&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Summer&#39;</span>
            <span class="k">WHEN</span> <span class="k">month</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">&#39;Fall&#39;</span>
            <span class="k">else</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">END</span>
    <span class="p">)</span> <span class="n">iowacity</span>
<span class="k">ON</span>
    <span class="n">oshkosh</span><span class="p">.</span><span class="n">season</span> <span class="o">=</span> <span class="n">iowacity</span><span class="p">.</span><span class="n">season</span>
</pre></div>

<ol>
<li>For Oshkosh, what 7 day period was the hottest? By hottest I mean, the average temperature of all readings from 12:00am on day 1 to 11:59pm on day 7.</li>
</ol>
<div class="codehilite"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">(</span><span class="k">year</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">month</span> <span class="nb">INT</span><span class="p">,</span>
<span class="k">day</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">time</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">temperature</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">dewpoint</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">humidity</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">sea_level_pressure</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">visibility</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">wind_direction</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">gust_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">precip</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">events</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">conditions</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_degrees</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;,&#39;</span>
<span class="k">LOCATION</span> <span class="s1">&#39;/user/maria_dev/final/Oshkosh/&#39;</span><span class="p">;</span>


<span class="k">SELECT</span>
    <span class="k">year</span><span class="p">,</span>
    <span class="k">month</span><span class="p">,</span>
    <span class="n">week</span><span class="p">,</span>
    <span class="n">avg_temp</span>
<span class="k">FROM</span> 
    <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="k">year</span><span class="p">,</span>
        <span class="k">month</span><span class="p">,</span>
        <span class="k">CASE</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="k">THEN</span> <span class="s1">&#39;week_1&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">14</span> <span class="k">THEN</span> <span class="s1">&#39;week_2&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">15</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="k">THEN</span> <span class="s1">&#39;week_3&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">22</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">28</span> <span class="k">THEN</span> <span class="s1">&#39;week_4&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">29</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">31</span> <span class="k">THEN</span> <span class="s1">&#39;week_5&#39;</span>
        <span class="k">END</span> <span class="k">as</span> <span class="n">week</span><span class="p">,</span>
        <span class="k">sum</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="k">count</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_temp</span>
    <span class="k">FROM</span> 
        <span class="n">oshkosh_tbl</span> <span class="n">o</span>
    <span class="k">WHERE</span>
        <span class="n">temperature</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span> 
        <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>
    <span class="k">GROUP</span> <span class="k">BY</span>
        <span class="k">year</span><span class="p">,</span>
        <span class="k">month</span><span class="p">,</span>
        <span class="k">CASE</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="k">THEN</span> <span class="s1">&#39;week_1&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">14</span> <span class="k">THEN</span> <span class="s1">&#39;week_2&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">15</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">21</span> <span class="k">THEN</span> <span class="s1">&#39;week_3&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">22</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">28</span> <span class="k">THEN</span> <span class="s1">&#39;week_4&#39;</span>
            <span class="k">WHEN</span> <span class="k">day</span> <span class="o">&gt;=</span> <span class="mi">29</span> <span class="k">and</span> <span class="k">day</span> <span class="o">&lt;=</span> <span class="mi">31</span> <span class="k">THEN</span> <span class="s1">&#39;week_5&#39;</span>
        <span class="k">END</span>
    <span class="p">)</span> <span class="n">sub</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">avg_temp</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">1</span>
</pre></div>

<ol>
<li>Solve this problem for Oshkosh only. For each day in the input file (e.g. February 1, 2004, May 11, 2010, January 29, 2007), determine the coldest time for that day. The coldest time for any given day is defined as the hour that has the coldest average. For example, a day may have had two readings during the 4am hour, one at 4:15am and one at 4:45am. The temperatures may have been 10.5 and 15.3. The average for 4am is 12.9. The 5am hour for that day may have had two readings at 5:14am and 5:35am and those readings were 11.3 and 11.5. The average for 5am is 11.4. 5am is thus considered colder. Once you have determined the coldest hour for each day, return the hour that has the most occurrences of the coldest average.</li>
</ol>
<div class="codehilite"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">oshkosh_tbl</span><span class="p">(</span><span class="k">year</span> <span class="n">STRING</span><span class="p">,</span> <span class="k">month</span> <span class="n">STRING</span><span class="p">,</span>
<span class="k">day</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">time</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">temperature</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">dewpoint</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">humidity</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">sea_level_pressure</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">visibility</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">wind_direction</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">gust_speed</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">precip</span> <span class="nb">FLOAT</span><span class="p">,</span> <span class="n">events</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">conditions</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">wind_degrees</span> <span class="nb">INT</span><span class="p">)</span> <span class="k">ROW</span> <span class="n">FORMAT</span> <span class="n">DELIMITED</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">&#39;,&#39;</span>
<span class="k">LOCATION</span> <span class="s1">&#39;/user/maria_dev/final/Oshkosh/&#39;</span><span class="p">;</span>

<span class="k">SELECT</span>
    <span class="n">hour_d</span>
<span class="k">FROM</span>
    <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">hour_d</span><span class="p">,</span>
        <span class="n">occurrences</span>
    <span class="k">FROM</span>
        <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="n">hour_d</span><span class="p">,</span>
            <span class="k">count</span><span class="p">(</span><span class="n">hour_d</span><span class="p">)</span> <span class="k">as</span> <span class="n">occurrences</span>
        <span class="k">FROM</span>
            <span class="p">(</span>
            <span class="k">SELECT</span>
                <span class="n">date_d</span><span class="p">,</span>
                <span class="n">hour_d</span><span class="p">,</span>
                <span class="n">rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="n">partition</span> <span class="k">by</span> <span class="n">date_d</span> <span class="k">order</span> <span class="k">by</span> <span class="n">avg_temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span>
            <span class="k">FROM</span>
                <span class="p">(</span>
                <span class="k">SELECT</span>
                    <span class="n">to_date</span><span class="p">(</span><span class="n">concat_ws</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="k">month</span><span class="p">,</span> <span class="k">day</span><span class="p">))</span> <span class="k">as</span> <span class="n">date_d</span><span class="p">,</span>
                    <span class="n">concat</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="ss">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">split</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="ss">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">hour_d</span><span class="p">,</span>
                    <span class="k">avg</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_temp</span>
                <span class="k">FROM</span> 
                    <span class="n">oshkosh_tbl</span> <span class="n">o</span>
                <span class="k">WHERE</span>
                    <span class="n">temperature</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span>
                    <span class="n">temperature</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9999</span>
                <span class="k">GROUP</span> <span class="k">BY</span>
                    <span class="n">to_date</span><span class="p">(</span><span class="n">concat_ws</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="k">year</span><span class="p">,</span> <span class="k">month</span><span class="p">,</span> <span class="k">day</span><span class="p">)),</span>
                    <span class="n">concat</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="ss">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">split</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="ss">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span> <span class="n">sub</span>
            <span class="p">)</span> <span class="n">sub2</span>
        <span class="k">WHERE</span>
            <span class="n">ranking</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">GROUP</span> <span class="k">BY</span>
            <span class="n">hour_d</span>
        <span class="p">)</span> <span class="n">sub3</span>
    <span class="k">ORDER</span> <span class="k">BY</span>
        <span class="n">occurrences</span> <span class="k">DESC</span>
    <span class="k">LIMIT</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="n">sub4</span>
</pre></div>

<ol>
<li>Which city had a time period of 24 hours or less that saw the largest temperature difference? Report the city, the temperature difference and the minimum amount of time it took to obtain that difference. Do not only consider whole days for this problem. The largest temperature difference may have been from 3pm on a Tuesday to 3pm on a Wednesday. The
largest temperature difference could have been from 11:07am on a Tuesday to 4:03am on a Wednesday. Or the largest difference could have been from 3:06pm on a Wednesday to 7:56pm on that same Wednesday. For a concrete example, consider Iowa City on January 1, 2000 at 2:53pm through January 2, 2000 at 2:53pm. The maximum temperature in that 24 hour span was 54 and the minimum temperature in that 24 hour span was 36. Therefore, in that 24 hour span, the largest temperature difference was 18 degrees. If this were the final answer, you would output “Iowa City”, “18 degrees” and January 2, 2000 3:53am to January 2, 2000 10:53am.</li>
</ol>
<div class="codehilite"><pre><span class="o">%</span><span class="n">spark</span>
<span class="k">import</span> <span class="nn">sqlContext.implicits._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.expressions.Window</span>

<span class="c1">// Oshkosh</span>

<span class="c1">// Load data</span>
<span class="k">val</span> <span class="n">oshkosh_weather</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;/user/maria_dev/final/Oshkosh/OshkoshWeather.csv&quot;</span><span class="o">)</span>
<span class="n">oshkosh_weather</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;okw&quot;</span><span class="o">)</span>

<span class="c1">// Pull various columns. Create timestamp from dates.</span>
<span class="k">val</span> <span class="n">updated_view</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) as from_dt, to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) + INTERVAL 24 HOURS as to_dt, CAST(to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) AS Long) dt_long, TemperatureF as temp FROM okw WHERE TemperatureF != -9999&quot;</span><span class="o">)</span>

<span class="c1">// Setup window for window function</span>
<span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">rangeBetween</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">86400</span><span class="o">)</span>

<span class="c1">// Run query that takes max-min difference of 24 hour window for every row (time)</span>
<span class="k">val</span> <span class="n">temp_diff_view</span> <span class="k">=</span> <span class="n">updated_view</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;temp_diff&quot;</span><span class="o">,</span> <span class="n">max</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;temp&quot;</span><span class="o">).</span><span class="n">over</span><span class="o">(</span><span class="n">window</span><span class="o">)-</span><span class="n">min</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;temp&quot;</span><span class="o">).</span><span class="n">over</span><span class="o">(</span><span class="n">window</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;temp&quot;</span><span class="o">)</span>

<span class="c1">// Rank temp differences</span>
<span class="k">val</span> <span class="n">rank_window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class=" -Symbol">&#39;temp_diff</span><span class="o">.</span><span class="n">desc</span><span class="o">)</span>
<span class="k">val</span> <span class="n">ranked_output</span> <span class="k">=</span> <span class="n">temp_diff_view</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;rank&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">rank_window</span><span class="o">)</span>

<span class="c1">// Produce final answer</span>
<span class="k">val</span> <span class="n">final_output</span> <span class="k">=</span> <span class="n">ranked_output</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;rank&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;rank&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="c1">// IowaCity</span>

<span class="c1">// Load data</span>
<span class="k">val</span> <span class="n">iowacity_weather</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;/user/maria_dev/final/IowaCity/IowaCityWeather.csv&quot;</span><span class="o">)</span>
<span class="n">iowacity_weather</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;iow&quot;</span><span class="o">)</span>

<span class="c1">// Pull various columns. Create timestamp from dates.</span>
<span class="k">val</span> <span class="n">updated_view_io</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) as from_dt, to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) + INTERVAL 24 HOURS as to_dt, CAST(to_timestamp(CONCAT(Year,&#39;-&#39;,Month,&#39;-&#39;,Day,&#39; &#39;,TimeCST), &#39;yyyy-MM-dd h:m a&#39;) AS Long) dt_long, TemperatureF as temp FROM iow WHERE TemperatureF != -9999&quot;</span><span class="o">)</span>

<span class="c1">// Setup window for window function</span>
<span class="k">val</span> <span class="n">window_io</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">rangeBetween</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">86400</span><span class="o">)</span>

<span class="c1">// Run query that takes max-min difference of 24 hour window for every row (time)</span>
<span class="k">val</span> <span class="n">temp_diff_view_io</span> <span class="k">=</span> <span class="n">updated_view_io</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;temp_diff&quot;</span><span class="o">,</span> <span class="n">max</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;temp&quot;</span><span class="o">).</span><span class="n">over</span><span class="o">(</span><span class="n">window_io</span><span class="o">)-</span><span class="n">min</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;temp&quot;</span><span class="o">).</span><span class="n">over</span><span class="o">(</span><span class="n">window_io</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;dt_long&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;temp&quot;</span><span class="o">)</span>

<span class="c1">// Rank temp differences</span>
<span class="k">val</span> <span class="n">rank_window_io</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class=" -Symbol">&#39;temp_diff</span><span class="o">.</span><span class="n">desc</span><span class="o">)</span>
<span class="k">val</span> <span class="n">ranked_output_io</span> <span class="k">=</span> <span class="n">temp_diff_view_io</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;rank&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">rank_window_io</span><span class="o">)</span>

<span class="c1">// Produce final answer</span>
<span class="k">val</span> <span class="n">final_output_io</span> <span class="k">=</span> <span class="n">ranked_output_io</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;rank&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;rank&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</pre></div>

<ol>
<li>As a runner, I want to know when is the best time and place to run. For each month, provide the hour (e.g. 7am, 5pm, etc) and city that is the best time to run. The best time and place to run will be defined as the time where the temperature is as close to 50 as possible. For this problem, you are averaging all temperatures with the same city and same hour and checking how far that average is from 50 degrees. If there is a tie, a tiebreaker will be the least windy hour on average. If there is still a tie, both hours and cities are reported.</li>
</ol>
<div class="codehilite"><pre><span class="o">%</span><span class="n">spark</span>
<span class="k">import</span> <span class="nn">sqlContext.implicits._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.expressions.Window</span>

<span class="c1">// Load data</span>
<span class="k">val</span> <span class="n">oshkosh_weather</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;/user/maria_dev/final/Oshkosh/OshkoshWeather.csv&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">iowacity_weather</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;/user/maria_dev/final/IowaCity/IowaCityWeather.csv&quot;</span><span class="o">)</span>

<span class="n">iowacity_weather</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;iow&quot;</span><span class="o">)</span>
<span class="n">oshkosh_weather</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;okw&quot;</span><span class="o">)</span>

<span class="c1">// Pull various columns. Create timestamp from dates.</span>
<span class="k">val</span> <span class="n">ok_view</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT month, CONCAT(split(TimeCST, &#39;:&#39;)[0], split(TimeCST, &#39; &#39;)[1]) as hour, &#39;Oshkosh&#39; as city, abs(avg(TemperatureF)-50) as temp_diff, avg(`Wind SpeedMPH`) as avg_wind FROM okw WHERE TemperatureF IS NOT NULL AND TemperatureF != -9999 AND `Wind SpeedMPH` IS NOT NULL AND `Wind SpeedMPH` != -9999 AND `Wind SpeedMPH` != &#39;Calm&#39; GROUP BY month, CONCAT(split(TimeCST, &#39;:&#39;)[0], split(TimeCST, &#39; &#39;)[1]), &#39;Oshkosh&#39;&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">io_view</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT month, CONCAT(split(TimeCST, &#39;:&#39;)[0], split(TimeCST, &#39; &#39;)[1]) as hour, &#39;IowaCity&#39; as city, abs(avg(TemperatureF)-50) as temp_diff, avg(`Wind SpeedMPH`) as avg_wind FROM iow WHERE TemperatureF IS NOT NULL AND TemperatureF != -9999 AND `Wind SpeedMPH` IS NOT NULL AND `Wind SpeedMPH` != -9999 AND `Wind SpeedMPH` != &#39;Calm&#39; GROUP BY month, CONCAT(split(TimeCST, &#39;:&#39;)[0], split(TimeCST, &#39; &#39;)[1]), &#39;IowaCity&#39;&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">unioned_data</span> <span class="k">=</span> <span class="n">ok_view</span><span class="o">.</span><span class="n">union</span><span class="o">(</span><span class="n">io_view</span><span class="o">)</span>
<span class="n">unioned_data</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;combined&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">combined_view</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT month, hour, city, round(temp_diff, 2) as temp_diff, round(avg_wind,2) as avg_wind FROM combined&quot;</span><span class="o">)</span>

<span class="c1">// Setup window for window function</span>
<span class="k">val</span> <span class="n">window_temp</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;month&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="s">&quot;temp_diff&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">ranked_data</span> <span class="k">=</span> <span class="n">combined_view</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;temp_rank&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window_temp</span><span class="o">)</span>

<span class="k">val</span> <span class="n">window_wind</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;month&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="s">&quot;avg_wind&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">filtered_data</span> <span class="k">=</span> <span class="n">ranked_data</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;temp_rank&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;wind_rank&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window_wind</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;month&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;temp_diff&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;avg_wind&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;temp_rank&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;wind_rank&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</pre></div>

<h2 id="problem-2">Problem 2<a class="headerlink" href="#problem-2" title="Permanent link"></a></h2>
<p>The solution to this problem must be done using Java threads. Due to budget cutbacks, the postal services at UW-Oshkosh can only afford 1 mail deliverer. Even worse, that deliverer is a student who works part-time. Postal services wants to minimize the amount of time that student has to work in order to save money. Because of this, they are interested in the fastest way to visit all buildings and return back to the Campus Services Building, BldgOne in the example below. There are obvious routes that are terrible (e.g. going from one side of campus to the other and then back) but the optimal route is not obvious. Your goal is to read in a file that gives the time in seconds to get from a building to every other building and determine the best possible route such that you start at the building listed on the first line, visit all other buildings and end at the building listed on the first line. The building names in the example below are arbitrary and can be called anything. The input file you will read in is called input2.txt​ and will be formatted in the following manner:</p>
<div class="codehilite"><pre>BldgOne : t(BldgOne) t(BldgTwo) t(BldgThree) t(BldgFour) t(BldgFive) 
BldgTwo : t(BldgOne) t(BldgTwo) t(BldgThree) t(BldgFour) t(BldgFive) 
BldgThree : t(BldgOne) t(BldgTwo) t(BldgThree) t(BldgFour) t(BldgFive) 
BldgFour : t(BldgOne) t(BldgTwo) t(BldgThree) t(BldgFour) t(BldgFive)
BldgFive : t(BldgOne) t(BldgTwo) t(BldgThree) t(BldgFour) t(BldgFive)
</pre></div>

<p>Take the first line for example. t(BldgTwo) will be an integer value denoting the number of seconds it takes to get from BldgOne to BldgTwo. On the first line, t(BldgOne) will be 0. In other words, it takes 0 time to get from BldgOne to BldgOne. The input will always be formatted in this manner. If another building is constructed, it will be added to the end and the file will be updated accordingly. For example, if BldgSix were constructed, the time to BldgSix will be added at the end of every list and BldgSix will be added to the end of the file. The time from BldgOne to BldgThree may not be the same as the time from BldgThree to BldgOne. There may be one way streets; it may be uphill, etc. A sample input file is shown below:</p>
<div class="codehilite"><pre>BldgA : 0 5 7
BldgB : 4 0 3
BldgC : 6 4 0
</pre></div>

<p><strong><em>Your goal is this</em></strong>: for the best route possible, print out the total time taken to start with the building on the first line, visit all buildings and then return to the building on the first line. You must also output the order in which you visited the buildings using the name of the buildings as defined in the input file. In the above example, there are only 2 possible routes: BldgA -&gt; BldgB -&gt; BldgC -&gt; BldgA which is 5 + 3 + 6 == 14. The other route is: BldgA -&gt; BldgC -&gt; BldgB -&gt; BldgA which is 7 + 4 + 4 == 15. Therefore, the output would be:</p>
<div class="codehilite"><pre>14 BldgA BldgB BldgC
</pre></div>

<h2 id="solution-in-python">Solution in Python<a class="headerlink" href="#solution-in-python" title="Permanent link"></a></h2>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>

<span class="n">buildings_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">building_id_map_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">building_id_map_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># read in file and create list of buildings and dict of buildings + times</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; : &quot;</span><span class="p">)</span>
        <span class="n">building</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">travel_times</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
        <span class="n">buildings_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">travel_times</span><span class="p">))</span>
        <span class="n">building_id_map_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">building</span><span class="p">))</span>
        <span class="n">building_id_map_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">building</span>

<span class="c1"># generate permutations of routes</span>
<span class="n">perm_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">building_id_map_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]))</span>
<span class="n">all_routes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm_list</span><span class="p">)):</span>
    <span class="n">perm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">perm_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">perm</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">building_id_map_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">perm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">building_id_map_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">all_routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>

<span class="c1"># create new list to contain route times</span>
<span class="n">route_times</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># loop through every route (permutation) in all_routes and set total_time to 0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">route</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_routes</span><span class="p">):</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># loop through sequence of indices for every route and define current + next building</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">route</span><span class="p">)):</span>
        <span class="n">current_building</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">next_building</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># get time to go from current building to next building</span>
        <span class="n">time_to_next_bld</span> <span class="o">=</span> <span class="n">buildings_dict</span><span class="p">[</span><span class="n">current_building</span><span class="p">][</span><span class="n">next_building</span><span class="p">]</span>
        <span class="n">total_time</span> <span class="o">+=</span> <span class="n">time_to_next_bld</span>

    <span class="c1"># append route index and time to route_times</span>
    <span class="n">route_times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">total_time</span><span class="p">))</span>


<span class="c1"># get minimum travel time</span>
<span class="n">min_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">route_times</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">route</span><span class="p">:</span> <span class="n">route</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># get route</span>
<span class="n">route</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">building_id_map_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_routes</span><span class="p">[</span><span class="n">min_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># subset route time</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">min_time</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;{time} {route}&quot;</span><span class="p">)</span>

<span class="n">stop_time</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Time elapsed: &#39;</span><span class="p">,</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</pre></div>

<h2 id="solution-in-java">Solution in Java<a class="headerlink" href="#solution-in-java" title="Permanent link"></a></h2>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RouteOptimizer</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="c1">// private ListIterator&lt;List&lt;Integer&gt;&gt; iterator;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">perm_subset</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">buildings_map</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">route_times</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">start</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">RouteOptimizer</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">perm_subset</span><span class="o">,</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">buildings_map</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">buildings_map</span> <span class="o">=</span> <span class="n">buildings_map</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">route_times</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">perm_subset</span> <span class="o">=</span> <span class="n">perm_subset</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// for each route in an array, compute the time of the route and assign the route an id. add this to route_times array.</span>

        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">route</span> <span class="o">:</span> <span class="n">perm_subset</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">total_time</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">route</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">current_building_index</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">next_building_index</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">building_times</span> <span class="o">=</span> <span class="n">buildings_map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">current_building_index</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">time_to_next_bld</span> <span class="o">=</span> <span class="n">building_times</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">next_building_index</span><span class="o">);</span>
                <span class="n">total_time</span> <span class="o">+=</span> <span class="n">time_to_next_bld</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">route_times</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">total_time</span><span class="o">);</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">get_route_times</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route_times</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// function to generate permutations</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="nf">get_permutations</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">original</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;();</span> 
            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;());</span> 
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span> 
        <span class="o">}</span>

        <span class="n">Integer</span> <span class="n">firstElement</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">permutations</span> <span class="o">=</span> <span class="n">get_permutations</span><span class="o">(</span><span class="n">original</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">smallerPermutated</span> <span class="o">:</span> <span class="n">permutations</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="n">smallerPermutated</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">index</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">smallerPermutated</span><span class="o">);</span>
                <span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">firstElement</span><span class="o">);</span>
                <span class="n">returnValue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// Start timer</span>
        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

        <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">buildings_map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">buildings_id_map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">input_list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// Read in file</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;input2.txt&quot;</span><span class="o">);</span>

        <span class="c1">// read in file</span>
        <span class="k">try</span><span class="o">(</span><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
            <span class="o">{</span>
                <span class="kt">int</span> <span class="n">building_id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">line</span><span class="o">;</span>  <span class="o">(</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">building_id</span><span class="o">++</span> <span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// split file into list by colon</span>
                    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">line_list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; : &quot;</span><span class="o">)));</span>
                    <span class="n">String</span> <span class="n">building_name</span> <span class="o">=</span> <span class="n">line_list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

                    <span class="c1">// convert (string) travel times to list</span>
                    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">travel_times_str</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">line_list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">replace</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">)));</span>
                    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">travel_times</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>

                    <span class="c1">// convert travel times to int</span>
                    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">time</span> <span class="o">:</span> <span class="n">travel_times_str</span><span class="o">)</span> <span class="n">travel_times</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">time</span><span class="o">));</span>

                    <span class="c1">// write building key + travel times to TreeMap</span>
                    <span class="n">buildings_map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">building_id</span><span class="o">,</span> <span class="n">travel_times</span><span class="o">);</span>
                    <span class="n">buildings_id_map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">building_id</span><span class="o">,</span> <span class="n">building_name</span><span class="o">);</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">building_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">input_list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">building_id</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="o">}</span>

        <span class="c1">// get permutations</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">permutations</span> <span class="o">=</span> <span class="n">get_permutations</span><span class="o">(</span><span class="n">input_list</span><span class="o">);</span>

        <span class="c1">// loop through permutations and add start/end building</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">permutations</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">perm</span> <span class="o">=</span> <span class="n">permutations</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="n">perm</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">perm</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">permutations</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">perm</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// section start: split the list of permutations into chunks, and assign each chunk to a thread for mapping route to time</span>
        <span class="kt">int</span> <span class="n">num_permutations</span> <span class="o">=</span> <span class="n">permutations</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">num_threads</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

        <span class="k">if</span><span class="o">(</span><span class="n">num_permutations</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">num_threads</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">RouteOptimizer</span><span class="o">[]</span> <span class="n">agents</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RouteOptimizer</span><span class="o">[</span><span class="n">num_threads</span><span class="o">];</span>

        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">perm_per_thread</span> <span class="o">=</span> <span class="n">num_permutations</span> <span class="o">/</span> <span class="n">num_threads</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">thread_id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">len_test</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_permutations</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="n">perm_per_thread</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="n">num_permutations</span><span class="o">)</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">perm_subset</span> <span class="o">=</span> <span class="n">permutations</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
                <span class="n">agents</span><span class="o">[</span><span class="n">thread_id</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RouteOptimizer</span><span class="o">(</span><span class="n">perm_subset</span><span class="o">,</span> <span class="n">buildings_map</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
                <span class="n">agents</span><span class="o">[</span><span class="n">thread_id</span><span class="o">].</span><span class="na">start</span><span class="o">();</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                <span class="n">thread_id</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// section end</span>

        <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">all_routes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// section start: get mapped list of route times for each thread</span>
        <span class="k">for</span><span class="o">(</span><span class="n">RouteOptimizer</span> <span class="n">agent</span> <span class="o">:</span> <span class="n">agents</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">agent</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">agent</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">thread_routes</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="na">get_route_times</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">thread_routes</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">time</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">all_routes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">time</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// get minimum route time</span>
        <span class="n">Integer</span> <span class="n">min_time</span> <span class="o">=</span> <span class="n">all_routes</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">min</span><span class="o">(</span><span class="n">Integer</span><span class="o">::</span><span class="n">compare</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

        <span class="c1">// get route for minimum route time</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">all_routes</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">min_time</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">FileWriter</span> <span class="n">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;output2.txt&quot;</span><span class="o">);</span>
                <span class="n">PrintWriter</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">fileWriter</span><span class="o">);</span>

                <span class="n">Integer</span> <span class="n">min_index</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>             
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">route_indices</span> <span class="o">=</span> <span class="n">permutations</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">min_index</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">optimal_route</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">min_time</span><span class="o">);</span>

                <span class="c1">// print results</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">route_indices</span><span class="o">.</span><span class="na">size</span><span class="o">()-</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">next_building</span> <span class="o">=</span> <span class="n">buildings_id_map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">route_indices</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                    <span class="n">optimal_route</span> <span class="o">=</span> <span class="n">optimal_route</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">next_building</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">optimal_route</span><span class="o">);</span>
                <span class="n">output</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>       

        <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">elapsedTime</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">elapsedTime</span><span class="o">);</span>
    <span class="o">}</span>   
<span class="o">}</span>
</pre></div>

<h2 id="problem-3">Problem 3<a class="headerlink" href="#problem-3" title="Permanent link"></a></h2>
<h3 id="about-the-data">About the data<a class="headerlink" href="#about-the-data" title="Permanent link"></a></h3>
<p>The <a href="http://stat-computing.org/dataexpo/2009/the-data.html">dataset</a> I used for this problem &ldquo;consists of flight arrival and departure details for all commercial flights within the USA, from October 1987 to April 2008&rdquo;<sup>[1]</sup>. I originally found this dataset from <a href="https://hadoopilluminated.com/hadoop_illuminated/Public_Bigdata_Sets.html">Hadoop Illuminated</a> <sup>[3]</sup>.</p>
<ul>
<li><sup>[1]</sup> Data source, <a href="http://stat-computing.org/dataexpo/2009/the-data.html">http://stat-computing.org/dataexpo/2009/the-data.html</a></li>
<li><sup>[2]</sup> Data info, <a href="http://stat-computing.org/dataexpo/2009/">http://stat-computing.org/dataexpo/2009/</a></li>
<li><sup>[3]</sup> Hadoop Illuminated, <a href="https://hadoopilluminated.com/hadoop_illuminated/Public_Bigdata_Sets.html">https://hadoopilluminated.com/hadoop_illuminated/Public_Bigdata_Sets.html</a></li>
</ul>
<h3 id="data-format">Data format<a class="headerlink" href="#data-format" title="Permanent link"></a></h3>
<p>All of the source data files are compressed CSV files. There are 22 of them in total. Compressed - their collective size is about 1.6gb. Uncompressed - their size is about 12 gb. I downloaded them onto EC2, uncompressed them, and then transferred these files to S3. The core data was accompanied by supplementary files that I used for mapping (airports and carriers). </p>
<h3 id="s3-storage">S3 storage<a class="headerlink" href="#s3-storage" title="Permanent link"></a></h3>
<p>The data is stored on S3 at the following locations:</p>
<ul>
<li><strong>Flight data</strong>: s3a://ebfp3/flight_data/</li>
<li><strong>Supplemental data</strong> (carriers and airports): s3a://ebfp3/supp_data/</li>
</ul>
<h3 id="questions-and-answers-">Questions and Answers -<a class="headerlink" href="#questions-and-answers-" title="Permanent link"></a></h3>
<h4 id="question-1">Question 1<a class="headerlink" href="#question-1" title="Permanent link"></a></h4>
<ul>
<li>Since 1987, which airline has most departure delays per year <em>for all 22 years of collected data</em>? Said differently: which airline was the most late the most often?</li>
</ul>
<h4 id="code">Code<a class="headerlink" href="#code" title="Permanent link"></a></h4>
<div class="codehilite"><pre><span class="k">import</span> <span class="nn">org.apache.spark.sql.expressions.Window</span><span class="o">;</span>

<span class="c1">// ------------ Setup ------------</span>

<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;s3a://ebfp3/flight_data/*.csv&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">carriers</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;s3a://ebfp3/supp_data/carriers.csv&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">airports</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;csv&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;s3a://ebfp3/supp_data/airports.csv&quot;</span><span class="o">);</span>

<span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;data_p&quot;</span><span class="o">);</span>
<span class="n">carriers</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;carriers_p&quot;</span><span class="o">);</span>
<span class="n">airports</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;airports_p&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">df_p</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span><span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;data_p&quot;</span><span class="o">);</span>
<span class="k">val</span> <span class="n">df_carriers</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span><span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;carriers_p&quot;</span><span class="o">);</span>
<span class="k">val</span> <span class="n">df_airports</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span><span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;airports_p&quot;</span><span class="o">);</span>

<span class="n">df_p</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;ap&quot;</span><span class="o">);</span>
<span class="n">df_carriers</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;ap_carriers&quot;</span><span class="o">);</span>
<span class="n">df_airports</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;ap_airports&quot;</span><span class="o">);</span>

<span class="c1">// ------------ Question 1 ------------</span>

<span class="k">val</span> <span class="n">view_data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Year, UniqueCarrier, sum(cast(DepDelay as INT)) as sum_dep_delay FROM ap GROUP BY Year, UniqueCarrier&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">view_carriers</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Code, Description FROM ap_carriers&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">joined_data</span> <span class="k">=</span> <span class="n">view_data</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">view_carriers</span><span class="o">,</span> <span class="n">view_data</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;UniqueCarrier&quot;</span><span class="o">)</span> <span class="o">===</span> <span class="n">view_carriers</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;year&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;sum_dep_delay&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">);</span>
<span class="k">val</span> <span class="n">ranked_data</span> <span class="k">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;delay_rank&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;delay_rank&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;year&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;delay_rank&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">final_output</span> <span class="k">=</span> <span class="n">ranked_data</span><span class="o">.</span><span class="n">groupBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;Description&quot;</span><span class="o">).</span><span class="n">agg</span><span class="o">(</span><span class="n">count</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;Description&quot;</span><span class="o">).</span><span class="n">alias</span><span class="o">(</span><span class="s">&quot;Count&quot;</span><span class="o">)).</span><span class="n">sort</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;Count&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">);</span>
</pre></div>

<h4 id="answer-1">Answer 1<a class="headerlink" href="#answer-1" title="Permanent link"></a></h4>
<div class="codehilite"><pre>+--------------------+-----+
|        Description |Count|
+--------------------+-----+
|Southwest Airline...|    9|
|Delta Air Lines Inc.|    7|
|United Air Lines ...|    3|
|US Airways Inc. (...|    2|
|Continental Air L...|    1|
+--------------------+-----+
</pre></div>

<p>Southwest Airlines had the highest frequency of &ldquo;most departure delays per year&rdquo;. The reverse analysis of most frequently having the <em>least delays per year</em> was Alaska Airlines.</p>
<h4 id="question-2">Question 2<a class="headerlink" href="#question-2" title="Permanent link"></a></h4>
<ul>
<li>For each year, which airline flew the least of amount of miles compared to the yearly average (of miles flown by all airlines). Display the year, month, carrier, and % difference.</li>
</ul>
<h4 id="code-2">Code 2<a class="headerlink" href="#code-2" title="Permanent link"></a></h4>
<div class="codehilite"><pre><span class="c1">// ------------ Question 2 ------------</span>

<span class="k">val</span> <span class="n">view_data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Year, Month, UniqueCarrier, sum(cast(Distance as INT)) as sum_distance FROM ap GROUP BY Year, Month, UniqueCarrier&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">view_carriers</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Code, Description FROM ap_carriers&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">joined_data</span> <span class="k">=</span> <span class="n">view_data</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">view_carriers</span><span class="o">,</span> <span class="n">view_data</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;UniqueCarrier&quot;</span><span class="o">)</span> <span class="o">===</span> <span class="n">view_carriers</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;year&quot;</span><span class="o">);</span>
<span class="k">val</span> <span class="n">data_with_avg</span> <span class="k">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;yearly_avg&quot;</span><span class="o">,</span> <span class="n">avg</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;sum_distance&quot;</span><span class="o">)</span> <span class="n">over</span> <span class="n">window</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;percent_diff&quot;</span><span class="o">,</span> <span class="n">round</span><span class="o">((</span><span class="n">$</span><span class="s">&quot;sum_distance&quot;</span> <span class="o">-</span> <span class="n">$</span><span class="s">&quot;yearly_avg&quot;</span><span class="o">)</span> <span class="o">/</span> <span class="n">$</span><span class="s">&quot;yearly_avg&quot;</span><span class="o">,</span> <span class="mi">4</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;yearly_avg&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">window2</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;year&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="s">&quot;percent_diff&quot;</span><span class="o">);</span>
<span class="k">val</span> <span class="n">ranked_data</span> <span class="k">=</span> <span class="n">data_with_avg</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window2</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;ranking&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;UniqueCarrier&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;sum_distance&quot;</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">).</span><span class="n">sort</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;Year&quot;</span><span class="o">);</span>
</pre></div>

<h4 id="answer-2">Answer 2<a class="headerlink" href="#answer-2" title="Permanent link"></a></h4>
<div class="codehilite"><pre>+----+-----+--------------------+------------+
|Year|Month|         Description|percent_diff|
+----+-----+--------------------+------------+
|1987|   10|Pan American Worl...|      -0.837|
|1988|    4|Pacific Southwest...|     -0.9357|
|1989|    5|Eastern Air Lines...|     -0.9588|
|1990|    2|Alaska Airlines Inc.|     -0.8394|
|1991|   11|Pan American Worl...|     -0.9001|
|1992|    2|Alaska Airlines Inc.|     -0.8515|
|1993|    2|Alaska Airlines Inc.|      -0.877|
|1994|    2|Alaska Airlines Inc.|     -0.8293|
|1995|    2|Alaska Airlines Inc.|     -0.7818|
|1996|   11|Alaska Airlines Inc.|     -0.7592|
|1997|    2|Alaska Airlines Inc.|     -0.7733|
|1998|    2|Alaska Airlines Inc.|     -0.7729|
|1999|    2|Alaska Airlines Inc.|     -0.7658|
|2000|   11| Aloha Airlines Inc.|     -0.9768|
|2001|    2| Aloha Airlines Inc.|     -0.9708|
|2002|    2|Alaska Airlines Inc.|     -0.7308|
|2003|   11|Hawaiian Airlines...|     -0.8977|
|2004|   10|Hawaiian Airlines...|     -0.9022|
|2004|   11|Hawaiian Airlines...|     -0.9022|
|2004|    9|Hawaiian Airlines...|     -0.9022|
|2005|    2|Hawaiian Airlines...|     -0.9066|
|2006|    4| Aloha Airlines Inc.|     -0.9308|
|2007|    2| Aloha Airlines Inc.|     -0.9333|
|2008|    2| Aloha Airlines Inc.|     -0.9275|
+----+-----+--------------------+------------+
</pre></div>

<p><strong>Interpretting the results</strong>: in 1987, Pan American flew 83.7% less miles than the average mileage flown by all airlines for that year. By 1991, that figure was 90% for Pan American. In another case: in 1989 Eastern Airlines flew 95.9% less miles than the yearly average. Not surprisingly - both airlines went out of business by the end of 1991. </p>
<p>Note that Alaska Airlines also had an underutilized fleet in the 90s. However, this airline changed it&rsquo;s pricing structure to increase competitiveness (by discounting fares drastically), and began to win over market share as a result. </p>
<h4 id="question-3">Question 3<a class="headerlink" href="#question-3" title="Permanent link"></a></h4>
<ul>
<li>For every airport, which months of the year have the most delays with exception of November and December? Delays are defined as CarrierDelay + WeatherDelay + NASDelay + SecurityDelay + LateAircraftDelay.<ul>
<li>Output the airport, city, month, sum of delays. </li>
<li>Output only top 20 airports</li>
</ul>
</li>
</ul>
<h4 id="code-3">Code 3<a class="headerlink" href="#code-3" title="Permanent link"></a></h4>
<div class="codehilite"><pre><span class="c1">// ------------ Question 3 ------------</span>

<span class="k">val</span> <span class="n">view_data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Origin, Month, sum(cast(CarrierDelay as INT)+ cast(WeatherDelay as INT) + cast(NASDelay as INT) + cast(SecurityDelay as INT) + cast(LateAircraftDelay as INT)) as sum_delays FROM ap WHERE Month != 11 and Month != 12 GROUP BY Origin, Month&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">view_airports</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT iata, airport, city FROM ap_airports&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">joined_data</span> <span class="k">=</span> <span class="n">view_data</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">view_airports</span><span class="o">,</span> <span class="n">view_data</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;Origin&quot;</span><span class="o">)</span> <span class="o">===</span> <span class="n">view_airports</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;iata&quot;</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;Origin&quot;</span><span class="o">,</span><span class="s">&quot;iata&quot;</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="s">&quot;sum_delays is not null&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;airport&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;sum_delays&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">);</span>
<span class="k">val</span> <span class="n">ranked_data</span> <span class="k">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;ranking&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">sort</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;sum_delays&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">).</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;airport&quot;</span><span class="o">,</span><span class="s">&quot;city&quot;</span><span class="o">,</span><span class="s">&quot;Month&quot;</span><span class="o">,</span><span class="s">&quot;sum_delays&quot;</span><span class="o">);</span>
</pre></div>

<h4 id="answer-3">Answer 3<a class="headerlink" href="#answer-3" title="Permanent link"></a></h4>
<div class="codehilite"><pre>+--------------------+-----------------+-----+----------+
|             airport|             city|Month|sum_delays|
+--------------------+-----------------+-----+----------+
|William B Hartsfi...|          Atlanta|    7|   4389913|
|Chicago O&#39;Hare In...|          Chicago|    7|   3670572|
|Dallas-Fort Worth...|Dallas-Fort Worth|    6|   2815249|
|         Newark Intl|           Newark|    7|   1856703|
|George Bush Inter...|          Houston|    6|   1621504|
|         Denver Intl|           Denver|    6|   1407076|
| John F Kennedy Intl|         New York|    7|   1400956|
|   Philadelphia Intl|     Philadelphia|    7|   1374650|
|           LaGuardia|         New York|    7|   1208416|
|Detroit Metropoli...|          Detroit|    6|   1168501|
|Los Angeles Inter...|      Los Angeles|    7|   1163292|
|McCarran Internat...|        Las Vegas|    7|   1146545|
|Gen Edw L Logan Intl|           Boston|    7|   1138799|
|Phoenix Sky Harbo...|          Phoenix|    7|   1087779|
|Washington Dulles...|        Chantilly|    6|   1049662|
|Minneapolis-St Pa...|      Minneapolis|    6|    989554|
|Orlando Internati...|          Orlando|    7|    962422|
|Charlotte/Douglas...|        Charlotte|    6|    961091|
|Baltimore-Washing...|        Baltimore|    6|    896289|
|San Francisco Int...|    San Francisco|    6|    841711|
+--------------------+-----------------+-----+----------+
</pre></div>

<p>Clearly, the summer months of June and July are the busiest time of year to travel (with exception of Nov, Dec), as evidenced by the number of delays. Hartsfield Intl. airport, being the busiest airport in the world by passenger traffic, has the most delays.</p>
<h4 id="question-4">Question 4<a class="headerlink" href="#question-4" title="Permanent link"></a></h4>
<ul>
<li>What is the most popular route of each airline? Route is defined as a combo of origin and destination. The time frame includes all years present in data. <ul>
<li>Output airline, origin, destination, and count of flights.</li>
</ul>
</li>
</ul>
<h4 id="code-4">Code 4<a class="headerlink" href="#code-4" title="Permanent link"></a></h4>
<div class="codehilite"><pre><span class="c1">// ------------ Question 4 ------------</span>

<span class="k">val</span> <span class="n">view_data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT UniqueCarrier as Carrier, Origin, Dest, count(*) as count_flights FROM ap GROUP BY UniqueCarrier, Origin, Dest&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">view_carriers</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="o">(</span><span class="s">&quot;SELECT Code, Description as Airline FROM ap_carriers&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">joined_data</span> <span class="k">=</span> <span class="n">view_data</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">view_carriers</span><span class="o">,</span> <span class="n">view_data</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;Carrier&quot;</span><span class="o">)</span> <span class="o">===</span> <span class="n">view_carriers</span><span class="o">.</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;Code&quot;</span><span class="o">,</span><span class="s">&quot;Carrier&quot;</span><span class="o">);</span>

<span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="nc">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="o">(</span><span class="s">&quot;Airline&quot;</span><span class="o">).</span><span class="n">orderBy</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;count_flights&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">);</span>
<span class="k">val</span> <span class="n">ranked_data</span> <span class="k">=</span> <span class="n">joined_data</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">,</span> <span class="n">rank</span> <span class="n">over</span> <span class="n">window</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;ranking&quot;</span> <span class="o">===</span> <span class="mi">1</span><span class="o">).</span><span class="n">sort</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;count_flights&quot;</span><span class="o">.</span><span class="n">desc</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;ranking&quot;</span><span class="o">).</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;Airline&quot;</span><span class="o">,</span><span class="s">&quot;Origin&quot;</span><span class="o">,</span><span class="s">&quot;Dest&quot;</span><span class="o">,</span><span class="s">&quot;Count_flights&quot;</span><span class="o">);</span>
</pre></div>

<h4 id="answer-4">Answer 4<a class="headerlink" href="#answer-4" title="Permanent link"></a></h4>
<div class="codehilite"><pre>+--------------------+------+----+-------------+
|             Airline|Origin|Dest|Count_flights|
+--------------------+------+----+-------------+
|Southwest Airline...|   HOU| DAL|       230971|
|United Air Lines ...|   SFO| LAX|       191983|
|American Airlines...|   ORD| DFW|       136731|
|Continental Air L...|   BOS| EWR|       111611|
|Delta Air Lines Inc.|   ATL| LGA|       107065|
|US Airways Inc. (...|   BOS| PHL|       106837|
|Alaska Airlines Inc.|   ANC| SEA|       104826|
|Northwest Airline...|   MSP| DTW|       102806|
|America West Airl...|   LAS| PHX|        89209|
|American Eagle Ai...|   SAN| LAX|        62283|
|Trans World Airwa...|   MCI| STL|        49293|
|Skywest Airlines ...|   SAN| LAX|        41894|
|Hawaiian Airlines...|   OGG| HNL|        37185|
|AirTran Airways C...|   MCO| ATL|        24152|
|     JetBlue Airways|   JFK| FLL|        23936|
| Aloha Airlines Inc.|   OGG| HNL|        22031|
|Expressjet Airlin...|   IAH| DAL|        21904|
|Pan American Worl...|   LGA| BOS|        21891|
|Atlantic Southeas...|   ATL| PFN|        16099|
|         Comair Inc.|   DCA| BOS|        12449|
|  Mesa Airlines Inc.|   PHX| TUS|        11110|
|Eastern Air Lines...|   BOS| DCA|        10494|
|ATA Airlines d/b/...|   LGA| MDW|        10425|
|    Independence Air|   JFK| IAD|         8909|
|Frontier Airlines...|   DEN| LAS|         8655|
|Piedmont Aviation...|   CLT| GSO|         6256|
|Pacific Southwest...|   SFO| LAX|         4149|
|Pinnacle Airlines...|   CVG| DTW|         3856|
|Midway Airlines I...|   DTW| MDW|         2539|
+--------------------+------+----+-------------+
</pre></div></article></body></html>